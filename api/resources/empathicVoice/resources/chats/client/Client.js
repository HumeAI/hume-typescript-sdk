/**
 * This file was auto-generated by Fern from our API Definition.
 */
var __awaiter =
    (this && this.__awaiter) ||
    function (thisArg, _arguments, P, generator) {
        function adopt(value) {
            return value instanceof P
                ? value
                : new P(function (resolve) {
                      resolve(value);
                  });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
            function fulfilled(value) {
                try {
                    step(generator.next(value));
                } catch (e) {
                    reject(e);
                }
            }
            function rejected(value) {
                try {
                    step(generator["throw"](value));
                } catch (e) {
                    reject(e);
                }
            }
            function step(result) {
                result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
            }
            step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
    };
import * as environments from "../../../../../../environments";
import * as core from "../../../../../../core";
import * as Hume from "../../../../../index";
import { mergeHeaders, mergeOnlyDefinedHeaders } from "../../../../../../core/headers.js";
import urlJoin from "url-join";
import * as serializers from "../../../../../../serialization/index";
import * as errors from "../../../../../../errors/index";
export class Chats {
    constructor(_options = {}) {
        this._options = _options;
    }
    /**
     * Fetches a paginated list of **Chats**.
     *
     * @param {Hume.empathicVoice.ChatsListChatsRequest} request
     * @param {Chats.RequestOptions} requestOptions - Request-specific configuration.
     *
     * @throws {@link Hume.empathicVoice.BadRequestError}
     *
     * @example
     *     await client.empathicVoice.chats.listChats({
     *         pageNumber: 0,
     *         pageSize: 1,
     *         ascendingOrder: true
     *     })
     */
    listChats() {
        return __awaiter(this, arguments, void 0, function* (request = {}, requestOptions) {
            const list = core.HttpResponsePromise.interceptFunction((request) =>
                __awaiter(this, void 0, void 0, function* () {
                    var _a, _b, _c, _d;
                    const { pageNumber, pageSize, ascendingOrder, configId } = request;
                    const _queryParams = {};
                    if (pageNumber != null) {
                        _queryParams["page_number"] = pageNumber.toString();
                    }
                    if (pageSize != null) {
                        _queryParams["page_size"] = pageSize.toString();
                    }
                    if (ascendingOrder != null) {
                        _queryParams["ascending_order"] = ascendingOrder.toString();
                    }
                    if (configId != null) {
                        _queryParams["config_id"] = configId;
                    }
                    const _response = yield (
                        (_a = this._options.fetcher) !== null && _a !== void 0 ? _a : core.fetcher
                    )({
                        url: urlJoin(
                            (_c =
                                (_b = yield core.Supplier.get(this._options.baseUrl)) !== null && _b !== void 0
                                    ? _b
                                    : yield core.Supplier.get(this._options.environment)) !== null && _c !== void 0
                                ? _c
                                : environments.HumeEnvironment.Production,
                            "v0/evi/chats",
                        ),
                        method: "GET",
                        headers: mergeHeaders(
                            (_d = this._options) === null || _d === void 0 ? void 0 : _d.headers,
                            mergeOnlyDefinedHeaders(Object.assign({}, yield this._getCustomAuthorizationHeaders())),
                            requestOptions === null || requestOptions === void 0 ? void 0 : requestOptions.headers,
                        ),
                        queryParameters: _queryParams,
                        timeoutMs:
                            (requestOptions === null || requestOptions === void 0
                                ? void 0
                                : requestOptions.timeoutInSeconds) != null
                                ? requestOptions.timeoutInSeconds * 1000
                                : 60000,
                        maxRetries:
                            requestOptions === null || requestOptions === void 0 ? void 0 : requestOptions.maxRetries,
                        abortSignal:
                            requestOptions === null || requestOptions === void 0 ? void 0 : requestOptions.abortSignal,
                    });
                    if (_response.ok) {
                        return {
                            data: serializers.empathicVoice.ReturnPagedChats.parseOrThrow(_response.body, {
                                unrecognizedObjectKeys: "passthrough",
                                allowUnrecognizedUnionMembers: true,
                                allowUnrecognizedEnumValues: true,
                                breadcrumbsPrefix: ["response"],
                            }),
                            rawResponse: _response.rawResponse,
                        };
                    }
                    if (_response.error.reason === "status-code") {
                        switch (_response.error.statusCode) {
                            case 400:
                                throw new Hume.empathicVoice.BadRequestError(
                                    serializers.empathicVoice.ErrorResponse.parseOrThrow(_response.error.body, {
                                        unrecognizedObjectKeys: "passthrough",
                                        allowUnrecognizedUnionMembers: true,
                                        allowUnrecognizedEnumValues: true,
                                        breadcrumbsPrefix: ["response"],
                                    }),
                                    _response.rawResponse,
                                );
                            default:
                                throw new errors.HumeError({
                                    statusCode: _response.error.statusCode,
                                    body: _response.error.body,
                                    rawResponse: _response.rawResponse,
                                });
                        }
                    }
                    switch (_response.error.reason) {
                        case "non-json":
                            throw new errors.HumeError({
                                statusCode: _response.error.statusCode,
                                body: _response.error.rawBody,
                                rawResponse: _response.rawResponse,
                            });
                        case "timeout":
                            throw new errors.HumeTimeoutError("Timeout exceeded when calling GET /v0/evi/chats.");
                        case "unknown":
                            throw new errors.HumeError({
                                message: _response.error.errorMessage,
                                rawResponse: _response.rawResponse,
                            });
                    }
                }),
            );
            let _offset =
                (request === null || request === void 0 ? void 0 : request.pageNumber) != null
                    ? request === null || request === void 0
                        ? void 0
                        : request.pageNumber
                    : 0;
            const dataWithRawResponse = yield list(request).withRawResponse();
            return new core.Pageable({
                response: dataWithRawResponse.data,
                rawResponse: dataWithRawResponse.rawResponse,
                hasNextPage: (response) => {
                    var _a;
                    return (
                        ((_a = response === null || response === void 0 ? void 0 : response.chatsPage) !== null &&
                        _a !== void 0
                            ? _a
                            : []
                        ).length > 0
                    );
                },
                getItems: (response) => {
                    var _a;
                    return (_a = response === null || response === void 0 ? void 0 : response.chatsPage) !== null &&
                        _a !== void 0
                        ? _a
                        : [];
                },
                loadPage: (_response) => {
                    _offset += 1;
                    return list(core.setObjectProperty(request, "pageNumber", _offset));
                },
            });
        });
    }
    /**
     * Fetches a paginated list of **Chat** events.
     *
     * @param {string} id - Identifier for a Chat. Formatted as a UUID.
     * @param {Hume.empathicVoice.ChatsListChatEventsRequest} request
     * @param {Chats.RequestOptions} requestOptions - Request-specific configuration.
     *
     * @throws {@link Hume.empathicVoice.BadRequestError}
     *
     * @example
     *     await client.empathicVoice.chats.listChatEvents("470a49f6-1dec-4afe-8b61-035d3b2d63b0", {
     *         pageNumber: 0,
     *         pageSize: 3,
     *         ascendingOrder: true
     *     })
     */
    listChatEvents(id_1) {
        return __awaiter(this, arguments, void 0, function* (id, request = {}, requestOptions) {
            const list = core.HttpResponsePromise.interceptFunction((request) =>
                __awaiter(this, void 0, void 0, function* () {
                    var _a, _b, _c, _d;
                    const { pageSize, pageNumber, ascendingOrder } = request;
                    const _queryParams = {};
                    if (pageSize != null) {
                        _queryParams["page_size"] = pageSize.toString();
                    }
                    if (pageNumber != null) {
                        _queryParams["page_number"] = pageNumber.toString();
                    }
                    if (ascendingOrder != null) {
                        _queryParams["ascending_order"] = ascendingOrder.toString();
                    }
                    const _response = yield (
                        (_a = this._options.fetcher) !== null && _a !== void 0 ? _a : core.fetcher
                    )({
                        url: urlJoin(
                            (_c =
                                (_b = yield core.Supplier.get(this._options.baseUrl)) !== null && _b !== void 0
                                    ? _b
                                    : yield core.Supplier.get(this._options.environment)) !== null && _c !== void 0
                                ? _c
                                : environments.HumeEnvironment.Production,
                            `v0/evi/chats/${encodeURIComponent(id)}`,
                        ),
                        method: "GET",
                        headers: mergeHeaders(
                            (_d = this._options) === null || _d === void 0 ? void 0 : _d.headers,
                            mergeOnlyDefinedHeaders(Object.assign({}, yield this._getCustomAuthorizationHeaders())),
                            requestOptions === null || requestOptions === void 0 ? void 0 : requestOptions.headers,
                        ),
                        queryParameters: _queryParams,
                        timeoutMs:
                            (requestOptions === null || requestOptions === void 0
                                ? void 0
                                : requestOptions.timeoutInSeconds) != null
                                ? requestOptions.timeoutInSeconds * 1000
                                : 60000,
                        maxRetries:
                            requestOptions === null || requestOptions === void 0 ? void 0 : requestOptions.maxRetries,
                        abortSignal:
                            requestOptions === null || requestOptions === void 0 ? void 0 : requestOptions.abortSignal,
                    });
                    if (_response.ok) {
                        return {
                            data: serializers.empathicVoice.ReturnChatPagedEvents.parseOrThrow(_response.body, {
                                unrecognizedObjectKeys: "passthrough",
                                allowUnrecognizedUnionMembers: true,
                                allowUnrecognizedEnumValues: true,
                                breadcrumbsPrefix: ["response"],
                            }),
                            rawResponse: _response.rawResponse,
                        };
                    }
                    if (_response.error.reason === "status-code") {
                        switch (_response.error.statusCode) {
                            case 400:
                                throw new Hume.empathicVoice.BadRequestError(
                                    serializers.empathicVoice.ErrorResponse.parseOrThrow(_response.error.body, {
                                        unrecognizedObjectKeys: "passthrough",
                                        allowUnrecognizedUnionMembers: true,
                                        allowUnrecognizedEnumValues: true,
                                        breadcrumbsPrefix: ["response"],
                                    }),
                                    _response.rawResponse,
                                );
                            default:
                                throw new errors.HumeError({
                                    statusCode: _response.error.statusCode,
                                    body: _response.error.body,
                                    rawResponse: _response.rawResponse,
                                });
                        }
                    }
                    switch (_response.error.reason) {
                        case "non-json":
                            throw new errors.HumeError({
                                statusCode: _response.error.statusCode,
                                body: _response.error.rawBody,
                                rawResponse: _response.rawResponse,
                            });
                        case "timeout":
                            throw new errors.HumeTimeoutError("Timeout exceeded when calling GET /v0/evi/chats/{id}.");
                        case "unknown":
                            throw new errors.HumeError({
                                message: _response.error.errorMessage,
                                rawResponse: _response.rawResponse,
                            });
                    }
                }),
            );
            let _offset =
                (request === null || request === void 0 ? void 0 : request.pageNumber) != null
                    ? request === null || request === void 0
                        ? void 0
                        : request.pageNumber
                    : 0;
            const dataWithRawResponse = yield list(request).withRawResponse();
            return new core.Pageable({
                response: dataWithRawResponse.data,
                rawResponse: dataWithRawResponse.rawResponse,
                hasNextPage: (response) => {
                    var _a;
                    return (
                        ((_a = response === null || response === void 0 ? void 0 : response.eventsPage) !== null &&
                        _a !== void 0
                            ? _a
                            : []
                        ).length > 0
                    );
                },
                getItems: (response) => {
                    var _a;
                    return (_a = response === null || response === void 0 ? void 0 : response.eventsPage) !== null &&
                        _a !== void 0
                        ? _a
                        : [];
                },
                loadPage: (_response) => {
                    _offset += 1;
                    return list(core.setObjectProperty(request, "pageNumber", _offset));
                },
            });
        });
    }
    /**
     * Fetches the audio of a previous **Chat**. For more details, see our guide on audio reconstruction [here](/docs/speech-to-speech-evi/faq#can-i-access-the-audio-of-previous-conversations-with-evi).
     *
     * @param {string} id - Identifier for a chat. Formatted as a UUID.
     * @param {Chats.RequestOptions} requestOptions - Request-specific configuration.
     *
     * @throws {@link Hume.empathicVoice.BadRequestError}
     *
     * @example
     *     await client.empathicVoice.chats.getAudio("470a49f6-1dec-4afe-8b61-035d3b2d63b0")
     */
    getAudio(id, requestOptions) {
        return core.HttpResponsePromise.fromPromise(this.__getAudio(id, requestOptions));
    }
    __getAudio(id, requestOptions) {
        return __awaiter(this, void 0, void 0, function* () {
            var _a, _b, _c, _d;
            const _response = yield ((_a = this._options.fetcher) !== null && _a !== void 0 ? _a : core.fetcher)({
                url: urlJoin(
                    (_c =
                        (_b = yield core.Supplier.get(this._options.baseUrl)) !== null && _b !== void 0
                            ? _b
                            : yield core.Supplier.get(this._options.environment)) !== null && _c !== void 0
                        ? _c
                        : environments.HumeEnvironment.Production,
                    `v0/evi/chats/${encodeURIComponent(id)}/audio`,
                ),
                method: "GET",
                headers: mergeHeaders(
                    (_d = this._options) === null || _d === void 0 ? void 0 : _d.headers,
                    mergeOnlyDefinedHeaders(Object.assign({}, yield this._getCustomAuthorizationHeaders())),
                    requestOptions === null || requestOptions === void 0 ? void 0 : requestOptions.headers,
                ),
                timeoutMs:
                    (requestOptions === null || requestOptions === void 0 ? void 0 : requestOptions.timeoutInSeconds) !=
                    null
                        ? requestOptions.timeoutInSeconds * 1000
                        : 60000,
                maxRetries: requestOptions === null || requestOptions === void 0 ? void 0 : requestOptions.maxRetries,
                abortSignal: requestOptions === null || requestOptions === void 0 ? void 0 : requestOptions.abortSignal,
            });
            if (_response.ok) {
                return {
                    data: serializers.empathicVoice.ReturnChatAudioReconstruction.parseOrThrow(_response.body, {
                        unrecognizedObjectKeys: "passthrough",
                        allowUnrecognizedUnionMembers: true,
                        allowUnrecognizedEnumValues: true,
                        breadcrumbsPrefix: ["response"],
                    }),
                    rawResponse: _response.rawResponse,
                };
            }
            if (_response.error.reason === "status-code") {
                switch (_response.error.statusCode) {
                    case 400:
                        throw new Hume.empathicVoice.BadRequestError(
                            serializers.empathicVoice.ErrorResponse.parseOrThrow(_response.error.body, {
                                unrecognizedObjectKeys: "passthrough",
                                allowUnrecognizedUnionMembers: true,
                                allowUnrecognizedEnumValues: true,
                                breadcrumbsPrefix: ["response"],
                            }),
                            _response.rawResponse,
                        );
                    default:
                        throw new errors.HumeError({
                            statusCode: _response.error.statusCode,
                            body: _response.error.body,
                            rawResponse: _response.rawResponse,
                        });
                }
            }
            switch (_response.error.reason) {
                case "non-json":
                    throw new errors.HumeError({
                        statusCode: _response.error.statusCode,
                        body: _response.error.rawBody,
                        rawResponse: _response.rawResponse,
                    });
                case "timeout":
                    throw new errors.HumeTimeoutError("Timeout exceeded when calling GET /v0/evi/chats/{id}/audio.");
                case "unknown":
                    throw new errors.HumeError({
                        message: _response.error.errorMessage,
                        rawResponse: _response.rawResponse,
                    });
            }
        });
    }
    _getCustomAuthorizationHeaders() {
        return __awaiter(this, void 0, void 0, function* () {
            const apiKeyValue = yield core.Supplier.get(this._options.apiKey);
            return { "X-Hume-Api-Key": apiKeyValue };
        });
    }
}
