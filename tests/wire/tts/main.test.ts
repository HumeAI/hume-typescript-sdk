/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../mock-server/MockServerPool";
import { HumeClient } from "../../../src/Client";
import * as Hume from "../../../src/api/index";

describe("Tts", () => {
    test("synthesize-json (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new HumeClient({
            apiKey: "test",
            environment: { base: server.baseUrl, evi: server.baseUrl, tts: server.baseUrl, stream: server.baseUrl },
        });
        const rawRequestBody = {
            context: {
                utterances: [
                    {
                        text: "How can people see beauty so differently?",
                        description:
                            "A curious student with a clear and respectful tone, seeking clarification on Hume's ideas with a straightforward question.",
                    },
                ],
            },
            format: { type: "mp3" },
            num_generations: 1,
            utterances: [
                {
                    text: "Beauty is no quality in things themselves: It exists merely in the mind which contemplates them.",
                    description:
                        "Middle-aged masculine voice with a clear, rhythmic Scots lilt, rounded vowels, and a warm, steady tone with an articulate, academic quality.",
                },
            ],
        };
        const rawResponseBody = {
            generations: [
                {
                    audio: "//PExAA0DDYRvkpNfhv3JI5JZ...etc.",
                    duration: 7.44225,
                    encoding: { format: "mp3", sample_rate: 48000 },
                    file_size: 120192,
                    generation_id: "795c949a-1510-4a80-9646-7d0863b023ab",
                    snippets: [
                        [
                            {
                                audio: "//PExAA0DDYRvkpNfhv3JI5JZ...etc.",
                                generation_id: "795c949a-1510-4a80-9646-7d0863b023ab",
                                id: "37b1b1b1-1b1b-1b1b-1b1b-1b1b1b1b1b1b",
                                text: "Beauty is no quality in things themselves: It exists merely in the mind which contemplates them.",
                                utterance_index: 0,
                                timestamps: [],
                            },
                        ],
                    ],
                },
            ],
            request_id: "66e01f90-4501-4aa0-bbaf-74f45dc15aa725906",
        };
        server
            .mockEndpoint()
            .post("/v0/tts")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.tts.synthesizeJson({
            context: {
                utterances: [
                    {
                        text: "How can people see beauty so differently?",
                        description:
                            "A curious student with a clear and respectful tone, seeking clarification on Hume's ideas with a straightforward question.",
                    },
                ],
            },
            format: {
                type: "mp3",
            },
            numGenerations: 1,
            utterances: [
                {
                    text: "Beauty is no quality in things themselves: It exists merely in the mind which contemplates them.",
                    description:
                        "Middle-aged masculine voice with a clear, rhythmic Scots lilt, rounded vowels, and a warm, steady tone with an articulate, academic quality.",
                },
            ],
        });
        expect(response).toEqual({
            generations: [
                {
                    audio: "//PExAA0DDYRvkpNfhv3JI5JZ...etc.",
                    duration: 7.44225,
                    encoding: {
                        format: "mp3",
                        sampleRate: 48000,
                    },
                    fileSize: 120192,
                    generationId: "795c949a-1510-4a80-9646-7d0863b023ab",
                    snippets: [
                        [
                            {
                                audio: "//PExAA0DDYRvkpNfhv3JI5JZ...etc.",
                                generationId: "795c949a-1510-4a80-9646-7d0863b023ab",
                                id: "37b1b1b1-1b1b-1b1b-1b1b-1b1b1b1b1b1b",
                                text: "Beauty is no quality in things themselves: It exists merely in the mind which contemplates them.",
                                utteranceIndex: 0,
                                timestamps: [],
                            },
                        ],
                    ],
                },
            ],
            requestId: "66e01f90-4501-4aa0-bbaf-74f45dc15aa725906",
        });
    });

    test("synthesize-json (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new HumeClient({
            apiKey: "test",
            environment: { base: server.baseUrl, evi: server.baseUrl, tts: server.baseUrl, stream: server.baseUrl },
        });
        const rawRequestBody = {
            version: undefined,
            context: undefined,
            utterances: [
                {
                    text: "text",
                    description: undefined,
                    voice: undefined,
                    speed: undefined,
                    trailing_silence: undefined,
                },
                {
                    text: "text",
                    description: undefined,
                    voice: undefined,
                    speed: undefined,
                    trailing_silence: undefined,
                },
            ],
            num_generations: undefined,
            format: undefined,
            split_utterances: undefined,
            strip_headers: undefined,
            include_timestamp_types: undefined,
            instant_mode: undefined,
        };
        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .post("/v0/tts")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tts.synthesizeJson({
                version: undefined,
                context: undefined,
                utterances: [
                    {
                        text: "text",
                        description: undefined,
                        voice: undefined,
                        speed: undefined,
                        trailingSilence: undefined,
                    },
                    {
                        text: "text",
                        description: undefined,
                        voice: undefined,
                        speed: undefined,
                        trailingSilence: undefined,
                    },
                ],
                numGenerations: undefined,
                format: undefined,
                splitUtterances: undefined,
                stripHeaders: undefined,
                includeTimestampTypes: undefined,
                instantMode: undefined,
            });
        }).rejects.toThrow(
            new Hume.tts.UnprocessableEntityError({
                detail: undefined,
            }),
        );
    });
});
