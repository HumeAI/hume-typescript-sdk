/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../mock-server/MockServerPool.js";
import { HumeClient } from "../../../src/Client";

describe("Tts", () => {
    test("synthesize-json", async () => {
        const server = mockServerPool.createServer();
        const client = new HumeClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            utterances: [
                {
                    text: "Beauty is no quality in things themselves: It exists merely in the mind which contemplates them.",
                    description:
                        "Middle-aged masculine voice with a clear, rhythmic Scots lilt, rounded vowels, and a warm, steady tone with an articulate, academic quality.",
                },
            ],
            context: {
                utterances: [
                    {
                        text: "How can people see beauty so differently?",
                        description:
                            "A curious student with a clear and respectful tone, seeking clarification on Hume's ideas with a straightforward question.",
                    },
                ],
            },
            format: { type: "mp3" },
            num_generations: 1,
        };
        const rawResponseBody = {
            generations: [
                {
                    generation_id: "795c949a-1510-4a80-9646-7d0863b023ab",
                    duration: 7.44225,
                    file_size: 120192,
                    encoding: { format: "mp3", sample_rate: 48000 },
                    audio: "//PExAA0DDYRvkpNfhv3JI5JZ...etc.",
                    snippets: [
                        [
                            {
                                audio: "//PExAA0DDYRvkpNfhv3JI5JZ...etc.",
                                generation_id: "795c949a-1510-4a80-9646-7d0863b023ab",
                                id: "37b1b1b1-1b1b-1b1b-1b1b-1b1b1b1b1b1b",
                                text: "Beauty is no quality in things themselves: It exists merely in the mind which contemplates them.",
                                utterance_index: 0,
                            },
                        ],
                    ],
                },
            ],
            request_id: "66e01f90-4501-4aa0-bbaf-74f45dc15aa725906",
        };
        server
            .mockEndpoint()
            .post("/v0/tts")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.tts.synthesizeJson({
            body: {
                utterances: [
                    {
                        text: "Beauty is no quality in things themselves: It exists merely in the mind which contemplates them.",
                        description:
                            "Middle-aged masculine voice with a clear, rhythmic Scots lilt, rounded vowels, and a warm, steady tone with an articulate, academic quality.",
                    },
                ],
                context: {
                    utterances: [
                        {
                            text: "How can people see beauty so differently?",
                            description:
                                "A curious student with a clear and respectful tone, seeking clarification on Hume's ideas with a straightforward question.",
                        },
                    ],
                },
                format: {
                    type: "mp3",
                },
                numGenerations: 1,
            },
        });
        expect(response).toEqual({
            generations: [
                {
                    generationId: "795c949a-1510-4a80-9646-7d0863b023ab",
                    duration: 7.44225,
                    fileSize: 120192,
                    encoding: {
                        format: "mp3",
                        sampleRate: 48000,
                    },
                    audio: "//PExAA0DDYRvkpNfhv3JI5JZ...etc.",
                    snippets: [
                        [
                            {
                                audio: "//PExAA0DDYRvkpNfhv3JI5JZ...etc.",
                                generationId: "795c949a-1510-4a80-9646-7d0863b023ab",
                                id: "37b1b1b1-1b1b-1b1b-1b1b-1b1b1b1b1b1b",
                                text: "Beauty is no quality in things themselves: It exists merely in the mind which contemplates them.",
                                utteranceIndex: 0,
                            },
                        ],
                    ],
                },
            ],
            requestId: "66e01f90-4501-4aa0-bbaf-74f45dc15aa725906",
        });
    });
});
