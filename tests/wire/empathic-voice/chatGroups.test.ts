/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../mock-server/MockServerPool.js";
import { HumeClient } from "../../../src/Client";

describe("ChatGroups", () => {
    test("get-chat-group", async () => {
        const server = mockServerPool.createServer();
        const client = new HumeClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "369846cf-6ad5-404d-905e-a8acb5cdfc78",
            first_start_timestamp: 1712334213647,
            most_recent_start_timestamp: 1712334213647,
            num_chats: 1,
            page_number: 0,
            page_size: 1,
            total_pages: 1,
            pagination_direction: "ASC",
            chats_page: [
                {
                    id: "6375d4f8-cd3e-4d6b-b13b-ace66b7c8aaa",
                    chat_group_id: "369846cf-6ad5-404d-905e-a8acb5cdfc78",
                    status: "USER_ENDED",
                    start_timestamp: 1712334213647,
                    end_timestamp: 1712334332571,
                    event_count: 0,
                    metadata: undefined,
                    config: undefined,
                },
            ],
            active: false,
        };
        server
            .mockEndpoint()
            .get("/v0/evi/chat_groups/697056f0-6c7e-487d-9bd8-9c19df79f05f")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.empathicVoice.chatGroups.getChatGroup("697056f0-6c7e-487d-9bd8-9c19df79f05f", {
            pageNumber: 0,
            pageSize: 1,
            ascendingOrder: true,
        });
        expect(response).toEqual({
            id: "369846cf-6ad5-404d-905e-a8acb5cdfc78",
            firstStartTimestamp: 1712334213647,
            mostRecentStartTimestamp: 1712334213647,
            numChats: 1,
            pageNumber: 0,
            pageSize: 1,
            totalPages: 1,
            paginationDirection: "ASC",
            chatsPage: [
                {
                    id: "6375d4f8-cd3e-4d6b-b13b-ace66b7c8aaa",
                    chatGroupId: "369846cf-6ad5-404d-905e-a8acb5cdfc78",
                    status: "USER_ENDED",
                    startTimestamp: 1712334213647,
                    endTimestamp: 1712334332571,
                    eventCount: 0,
                    metadata: undefined,
                    config: undefined,
                },
            ],
            active: false,
        });
    });

    test("get-audio", async () => {
        const server = mockServerPool.createServer();
        const client = new HumeClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "369846cf-6ad5-404d-905e-a8acb5cdfc78",
            user_id: "e6235940-cfda-3988-9147-ff531627cf42",
            num_chats: 1,
            page_number: 0,
            page_size: 10,
            total_pages: 1,
            pagination_direction: "ASC",
            audio_reconstructions_page: [
                {
                    id: "470a49f6-1dec-4afe-8b61-035d3b2d63b0",
                    user_id: "e6235940-cfda-3988-9147-ff531627cf42",
                    status: "COMPLETE",
                    filename:
                        "e6235940-cfda-3988-9147-ff531627cf42/470a49f6-1dec-4afe-8b61-035d3b2d63b0/reconstructed_audio.mp4",
                    modified_at: 1729875432555,
                    signed_audio_url: "https://storage.googleapis.com/...etc.",
                    signed_url_expiration_timestamp_millis: 1730232816964,
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/v0/evi/chat_groups/369846cf-6ad5-404d-905e-a8acb5cdfc78/audio")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.empathicVoice.chatGroups.getAudio("369846cf-6ad5-404d-905e-a8acb5cdfc78", {
            pageNumber: 0,
            pageSize: 10,
            ascendingOrder: true,
        });
        expect(response).toEqual({
            id: "369846cf-6ad5-404d-905e-a8acb5cdfc78",
            userId: "e6235940-cfda-3988-9147-ff531627cf42",
            numChats: 1,
            pageNumber: 0,
            pageSize: 10,
            totalPages: 1,
            paginationDirection: "ASC",
            audioReconstructionsPage: [
                {
                    id: "470a49f6-1dec-4afe-8b61-035d3b2d63b0",
                    userId: "e6235940-cfda-3988-9147-ff531627cf42",
                    status: "COMPLETE",
                    filename:
                        "e6235940-cfda-3988-9147-ff531627cf42/470a49f6-1dec-4afe-8b61-035d3b2d63b0/reconstructed_audio.mp4",
                    modifiedAt: 1729875432555,
                    signedAudioUrl: "https://storage.googleapis.com/...etc.",
                    signedUrlExpirationTimestampMillis: 1730232816964,
                },
            ],
        });
    });
});
